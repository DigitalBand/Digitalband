@(product: Form[models.ProductDetails], images: Seq[Int], productId: Int)(implicit user: Option[models.UserEntity], request: play.api.mvc.Request[Any])
@import views.html.common.bootstrap._
@styles = {
    <link rel="stylesheet" media="screen" href="@routes.Assets.at("stylesheets/bootstrap/fileupload.min.css")"/>
}
@scripts = {
    <script src="@routes.Assets.at("javascripts/ckeditor/ckeditor.js")" type="text/javascript"></script>
    <script src="@routes.Assets.at("javascripts/bootstrap-fileupload/bootstrap-fileupload.js")" type="text/javascript"></script>
    <script>
            $(document).ready(function() {
                CKEDITOR.replace("description");
                $(".existent-image").click(function(){
                    var id = $(this).attr("data-imageId");
                    $("#image-" + id).after(' <input type="hidden" name="deletedImage" value="' + id + '"/> ');
                    $("#image-" + id).remove();
                    return false;
                });

                $("#title").change(function(){
                   var val = $(this).val();
                   loadGoogleImages(val, 1);
                });
                loadGoogleImages($("#title").val(), 1);
            });
            function addGoogleImage(index){
                var clonedImage = $("#googleimage-"+index).clone(true);
                clonedImage.attr("id", "clonedimage-"+index);
                $(".google-buttons", clonedImage).empty()
                    .append($('<a href="#" class="btn remove-googleImage" data-imageIndex="'+index+'"><i class="icon-remove"></i></a>'));
                $("input", clonedImage).attr("name", "googleimage");
                $(".fileupload").first().before(clonedImage);
                $(".remove-googleImage").click(function(){
                   var imageIndex = $(this).attr("data-imageIndex");
                   $("#clonedimage-"+index).remove();
                });
            }
            function loadGoogleImages(val, pageNumber){
                if (val.trim() !== "") {
                    $.get('@routes.GoogleSearch.imageList()',
                        { search: val, pageNumber: pageNumber},
                        function(data){
                            setData(data);
                        });
                }
            }
            function setData(data){
                $(".google.images").html(data);
                $(".google.images .pagination a").click(function(){
                    $.get($(this).attr("href"), function(data){
                        setData(data);
                    });
                    return false;
                });
                $(".add-image").click(function() {
                    var imageIndex = $(this).attr("data-imageIndex");
                    addGoogleImage(imageIndex);
                    return false;
                });
            }
    </script>
}
@views.html.Admin.main("Администрирование", "index", scripts = scripts, styles = styles) {
    <div class="page-header">
        <h4> @productId match {
            case 0 => {
                    Создание нового товара
                }
            case _ => {
                Редактирование товара
            }
        } </h4>
    </div>
    @request.flash.data.map {
        case (className, message) => {
            <div class="alert   @className"> @message </div>
        }
    }
    <form action="@controllers.admin.routes.Product.save()" method="POST" class="form-inline" enctype="multipart/form-data">
        <input type="hidden" name="categoryId" value="@product("categoryId").value" />
        <input type="hidden" name="id" value="@product("id").value" />
        <div class="row">
            <div class="span6">
                @helper.inputText(product("title"), '_label -> "Название")
                @helper.inputText(product("price"), '_label -> "Цена", 'type -> "number")
                @helper.textarea(product("shortDescription"), '_label -> "Краткое описание", 'class -> "span6")
                @helper.textarea(product("description"), '_label -> "Описание", 'rows -> "10", 'class -> "span6")
            </div>
            <div class="span6">
                @helper.inputText(product("brand"), '_label -> "Бренд")
                <div class="control-group">
                    <label class="control-label" for="image">
                            Фото
                    </label>
                    <div class="controls images">
                        @images.map { image =>
                            <div id="image-@image" class="fileupload" data-provides="fileupload">
                                <img class="thumbnail" src="@routes.Image.get(image + ".jpg", 90, "90x90", "full")"/>
                                <div>
                                    <a href="#" class="btn existent-image" data-imageId="@image"> <i class="icon-remove"></i> </a>
                                </div>
                            </div>
                        }
                        <div class="fileupload fileupload-new" data-provides="fileupload">
                            <div class="fileupload-preview thumbnail" style="width: 90px; height: 90px;"></div>
                            <div>
                                <span class="btn btn-file">
                                    <span class="fileupload-new"> <i class="icon-plus"></i> </span>
                                    <span class="fileupload-exists"> <i class="icon-edit"></i> </span>
                                    <input type="file" name="image" id="image" />
                                </span>
                                <a href="#" class="btn fileupload-exists" data-dismiss="fileupload"> <i class="icon-remove"></i> </a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="control-group" style="clear: both">
                    <label class="control-label">Google - Картинки</label>
                    <div class="controls google images">

                    </div>
                </div>
            </div>
        </div>

        <div class="form-actions">
            <button class="btn btn-primary"> <i class="icon-save"></i> Сохранить </button>
        </div>

    </form>
}